{% extends 'base.html' %}

{% block title %}ã‚­ãƒ£ãƒå¬¢Q&A - åŒ¿åæ²ç¤ºæ¿ï½ã‚­ãƒ£ãƒq.com{% endblock %}

{% block head_js %}
<script>
  function filterCategory(category) {
    const items = document.querySelectorAll('.qa-item');
    items.forEach(item => {
      if (category === 'all' || item.dataset.category === category) {
        item.classList.remove('hidden');
      } else {
        item.classList.add('hidden');
      }
    });

    const buttons = document.querySelectorAll('.category-button');
    buttons.forEach(btn => btn.classList.remove('bg-pink-400', 'text-white'));
    const activeBtn = document.querySelector(`[data-category-btn="${category}"]`);
    if (activeBtn) activeBtn.classList.add('bg-pink-400', 'text-white');
  }

  // å›ç­”ã®æŠ˜ã‚ŠãŸãŸã¿ãƒ»å±•é–‹æ©Ÿèƒ½
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.toggle-answer').forEach(function(btn) {
      btn.addEventListener('click', function() {
        const answerId = this.getAttribute('data-answer-id');
        const shortText = document.getElementById('short-' + answerId);
        const fullText = document.getElementById('full-' + answerId);
        
        if (shortText.classList.contains('hidden')) {
          // æŠ˜ã‚ŠãŸãŸã‚€
          shortText.classList.remove('hidden');
          fullText.classList.add('hidden');
          this.textContent = 'ç¶šãã‚’èª­ã‚€';
        } else {
          // å±•é–‹ã™ã‚‹
          shortText.classList.add('hidden');
          fullText.classList.remove('hidden');
          this.textContent = 'æŠ˜ã‚ŠãŸãŸã‚€';
        }
      });
    });
  });
</script>
{% endblock %}

{% block content %}
  <!-- ä¼šå“¡ç™»éŒ²æ¡ˆå†… -->
<section class="bg-pink-100 text-center p-4 text-sm">
  <p class="mb-1 font-semibold">ğŸ” ã“ã®å…ˆã®Q&Aã‚’ã‚‚ã£ã¨èª­ã¿ãŸã„ï¼Ÿ</p>
  <p class="mb-1">
    ç°¡å˜ãªä¼šå“¡ç™»éŒ²ã§ <span class="font-bold">æœ€åˆã®10æ—¥é–“ã¯ç„¡æ–™</span>ï¼<br>
    ãã®å¾Œã€åˆå›3ã‹æœˆã¯æœˆé¡ <span class="font-bold">1,000å††</span>ã€<br>
    ä»¥é™ã‚‚æœˆé¡ <span class="font-bold">1,000å††</span> ã§ã™ã¹ã¦è¦‹æ”¾é¡Œã«âœ¨
  </p>
  <p class="mb-1 text-xs text-gray-600">â€»ç„¡æ–™ä¼šå“¡ç™»éŒ²ã¯æ•°ç§’ã§å®Œäº†ã€æ”¯æ‰•ã„æƒ…å ±ã®ç™»éŒ²ã¯ä¸è¦ã§ã™ã€‚</p>
  <p class="mb-1 text-xs text-gray-600">â€»ç¶™ç¶šåˆ©ç”¨ã”å¸Œæœ›ã®å ´åˆã«ã¯ã€æ”¯æ‰•ã„æƒ…å ±ã®ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚</p>
  <p class="mb-1 text-xs text-gray-600">â€»æ”¯æ‰•ã„æƒ…å ±ãŒæœªç™»éŒ²ã®å ´åˆã€10æ—¥å¾Œã«åˆ©ç”¨ä¸å¯ã¨ãªã‚Šã¾ã™ã€‚</p>
  <button class="mt-2 bg-pink-400 hover:bg-pink-500 text-white text-sm px-6 py-2 rounded-full">
    ä»Šã™ãç„¡æ–™ä¼šå“¡ç™»éŒ²
  </button>
</section>

<!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆæ¨ª2æ®µãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»DBé€£æºï¼‰ -->
<div class="p-2 bg-white shadow">
  <!-- 1æ®µç›® â”€ ã€Œã™ã¹ã¦ã€ãƒœã‚¿ãƒ³ -->
  <div class="flex justify-left space-x-2 mb-2">
    <button
      onclick="filterCategory('all')"
      class="category-button bg-pink-400 text-white text-sm px-3 py-1 rounded-full"
      data-category-btn="all"
    >
      ã™ã¹ã¦
    </button>
  </div>

  <!-- 2æ®µç›® â”€ DB ã‹ã‚‰å–å¾—ã—ãŸã‚«ãƒ†ã‚´ãƒª -->
  <div class="flex flex-wrap gap-2 justify-start">
    {% for category in categories %}
      <button
        onclick="filterCategory('{{ category.name }}')"
        class="category-button bg-pink-200 hover:bg-pink-300 text-sm px-3 py-1 rounded-full"
        data-category-btn="{{ category.name }}"
      >
        {{ category.name }}
      </button>
    {% endfor %}
  </div>
</div>


<!-- æœ€æ–°Q&Aãƒªã‚¹ãƒˆï¼ˆçŸ¥æµè¢‹ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
<section class="p-3">
  <h2 class="text-lg font-bold mb-3">ğŸ“Œ æœ€æ–°ã®è³ªå•ï¼ˆ{{ questions|length }}ä»¶ï¼‰</h2>
  <div class="space-y-6">
    {% if questions %}
      {% for question in questions %}
        <div class="qa-item bg-white p-3 rounded-xl shadow" data-category="{{ question.category }}">
          <!-- è³ªå•éƒ¨åˆ† -->
          <div class="border-b pb-3 mb-3">
            <div class="flex items-start">
              <div class="bg-pink-100 text-pink-500 rounded-full w-6 h-6 flex items-center justify-center mr-2 mt-1 flex-shrink-0">
                <span class="text-xs font-bold">Q</span>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-base">{{ question.title }}</h3>
                <div class="text-xs text-gray-500 my-1">
                  <p>{{ question.user_nickname }}ã•ã‚“</p>
                </div>
                <p class="text-sm text-gray-700">{{ question.content }}</p>
              </div>
            </div>
            <div class="flex justify-between text-xs text-gray-500 mt-2">
              <span>å›ç­”æ•°ï¼š{{ question.answer_count }}ä»¶</span>
              <span>{{ question.updated_at }}</span>
            </div>
          </div>
          
          <!-- å›ç­”éƒ¨åˆ† -->
          <div>
            {% if question.answers %}
              {% for answer in question.answers %}
                <div class="mb-3 {% if loop.first %}bg-yellow-50 p-2 rounded{% endif %}">
                  <div class="flex items-start">
                    <div class="{% if loop.first %}bg-yellow-400 text-yellow-800{% else %}bg-gray-200 text-gray-600{% endif %} rounded-full w-6 h-6 flex items-center justify-center mr-2 mt-1 flex-shrink-0">
                      <span class="text-xs font-bold">A</span>
                    </div>
                    <div class="flex-1">
                      <div class="text-sm">
                        <span class="font-semibold">{{ answer.user_nickname }}ã•ã‚“</span>
                      </div>
                      {% if answer.content|length > 60 %}
                        <div class="answer-content">
                          <!-- çŸ­ã„ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæœ€åˆã«è¡¨ç¤ºï¼‰ -->
                          <p id="short-q{{ question.id }}a{{ loop.index }}" class="text-sm text-gray-700 mt-1">
                            {{ answer.content[:60] }}...
                          </p>
                          <!-- å…¨æ–‡ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
                          <p id="full-q{{ question.id }}a{{ loop.index }}" class="text-sm text-gray-700 mt-1 hidden">
                            {{ answer.content }}
                          </p>
                          <!-- ãƒœã‚¿ãƒ³ -->
                          <div class="text-right">
                            <button 
                              class="text-xs text-pink-500 hover:text-pink-600 mt-1 toggle-answer" 
                              data-answer-id="q{{ question.id }}a{{ loop.index }}">
                              ç¶šãã‚’èª­ã‚€
                            </button>
                          </div>
                        </div>
                      {% else %}
                        <p class="text-sm text-gray-700 mt-1">{{ answer.content }}</p>
                      {% endif %}
                      <div class="flex justify-between text-xs text-gray-500 mt-1">
                        {% if loop.first %}
                          <span class="text-yellow-600 font-semibold">âœ“ ãƒ™ã‚¹ãƒˆã‚¢ãƒ³ã‚µãƒ¼</span>
                        {% else %}
                          <span></span>
                        {% endif %}
                        <span>{{ answer.updated_at }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <p class="text-sm text-gray-500 italic">ã¾ã å›ç­”ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="text-center py-4 bg-white rounded-xl shadow">
        <p class="text-gray-500">ã¾ã è³ªå•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <button class="mt-2 bg-pink-400 hover:bg-pink-500 text-white text-sm px-6 py-2 rounded-full">æœ€åˆã®è³ªå•ã‚’æŠ•ç¨¿ã™ã‚‹</button>
      </div>
    {% endif %}
  </div>
</section>


<script>
  /* ã‚«ãƒ†ã‚´ãƒªåˆ‡æ›¿ */
  function filterCategory(category) {
    /* è³ªå•ã®çµã‚Šè¾¼ã¿ */
    document.querySelectorAll('.qa-item').forEach(item => {
      item.classList.toggle(
        'hidden',
        category !== 'all' && item.dataset.category !== category
      );
    });

    /* ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã®ä»˜ã‘æ›¿ãˆ */
    document.querySelectorAll('.category-button').forEach(btn => {
      btn.classList.remove('bg-pink-400', 'text-white');
    });
    const activeBtn = document.querySelector(`[data-category-btn="${category}"]`);
    if (activeBtn) activeBtn.classList.add('bg-pink-400', 'text-white');
  }

  /* ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã€Œã™ã¹ã¦ã€ã‚’é¸æŠçŠ¶æ…‹ã«ã—ã¦ãŠã */
  document.addEventListener('DOMContentLoaded', () => filterCategory('all'));
</script>
{% endblock %}
