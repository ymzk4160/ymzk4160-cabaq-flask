{% extends 'base.html' %}

{% block title %}ã‚­ãƒ£ãƒå¬¢Q&A - åŒ¿åæ²ç¤ºæ¿{% endblock %}

{% block head_js %}
<script>
  function filterCategory(category) {
    const items = document.querySelectorAll('.qa-item');
    items.forEach(item => {
      if (category === 'all' || item.dataset.category === category) {
        item.classList.remove('hidden');
      } else {
        item.classList.add('hidden');
      }
    });

    const buttons = document.querySelectorAll('.category-button');
    buttons.forEach(btn => btn.classList.remove('bg-pink-400', 'text-white'));
    const activeBtn = document.querySelector(`[data-category-btn="${category}"]`);
    if (activeBtn) activeBtn.classList.add('bg-pink-400', 'text-white');
  }
</script>
{% endblock %}

{% block content %}
  <!-- ä¼šå“¡ç™»éŒ²æ¡ˆå†… -->
<section class="bg-pink-100 text-center p-4 text-sm">
  <p class="mb-1 font-semibold">ğŸ” ã“ã®å…ˆã®Q&Aã‚’ã‚‚ã£ã¨èª­ã¿ãŸã„ï¼Ÿ</p>
  <p class="mb-1">
    ç°¡å˜ãªä¼šå“¡ç™»éŒ²ã§ <span class="font-bold">æœ€åˆã®10æ—¥é–“ã¯ç„¡æ–™</span>ï¼<br>
    ãã®å¾Œã€åˆå›3ã‹æœˆã¯æœˆé¡ <span class="font-bold">1,000å††</span>ã€<br>
    ä»¥é™ã‚‚æœˆé¡ <span class="font-bold">1,000å††</span> ã§ã™ã¹ã¦è¦‹æ”¾é¡Œã«âœ¨
  </p>
  <p class="mb-1 text-xs text-gray-600">â€»ç„¡æ–™ä¼šå“¡ç™»éŒ²ã¯æ•°ç§’ã§å®Œäº†ã€æ”¯æ‰•ã„æƒ…å ±ã®ç™»éŒ²ã¯ä¸è¦ã§ã™ã€‚</p>
  <p class="mb-1 text-xs text-gray-600">â€»ç¶™ç¶šåˆ©ç”¨ã”å¸Œæœ›ã®å ´åˆã«ã¯ã€æ”¯æ‰•ã„æƒ…å ±ã®ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚</p>
  <p class="mb-1 text-xs text-gray-600">â€»æ”¯æ‰•ã„æƒ…å ±ãŒæœªç™»éŒ²ã®å ´åˆã€10æ—¥å¾Œã«åˆ©ç”¨ä¸å¯ã¨ãªã‚Šã¾ã™ã€‚</p>
  <button class="mt-2 bg-pink-400 hover:bg-pink-500 text-white text-sm px-6 py-2 rounded-full">
    ä»Šã™ãç„¡æ–™ä¼šå“¡ç™»éŒ²
  </button>
</section>


<!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆã‚°ãƒªãƒƒãƒ‰ãƒ™ãƒ¼ã‚¹ã®ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ï¼‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»æ å†…åã¾ã‚Šä¿è¨¼ï¼‰ -->
<div id="category-container" class="p-2 bg-white shadow relative min-h-[150px]">
  <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒœã‚¿ãƒ³ã¯JavaScriptã§å‹•çš„ã«é…ç½®ã•ã‚Œã¾ã™ -->
</div>

<script>
  // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ãƒ‡ãƒ¼ã‚¿
  const categories = [
    { id: 'all', name: 'ã™ã¹ã¦', color: 'bg-pink-400 text-white' },
    { id: 'åˆå¿ƒè€…', name: 'åˆå¿ƒè€…', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'å–¶æ¥­', name: 'å–¶æ¥­', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'å‡ºå‹¤', name: 'å‡ºå‹¤', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'ãƒãƒ¼ã‚¹ãƒ‡ã‚¤', name: 'ãƒãƒ¼ã‚¹ãƒ‡ã‚¤', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'ãƒ¡ãƒ³ã‚¿ãƒ«', name: 'ãƒ¡ãƒ³ã‚¿ãƒ«', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'èº«ãƒãƒ¬', name: 'èº«ãƒãƒ¬', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'åº—ä¸æº€', name: 'åº—ã¸ã®ä¸æº€', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'ç¾å®¹', name: 'ç¾å®¹', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'æ‹æ„›', name: 'æ‹æ„›', color: 'bg-pink-200 hover:bg-pink-300' },
    { id: 'ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ', name: 'ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ', color: 'bg-pink-200 hover:bg-pink-300' }
  ];

  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
  const style = document.createElement('style');
  style.textContent = `
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
  `;
  document.head.appendChild(style);

  // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒœã‚¿ãƒ³ã‚’ã‚°ãƒªãƒƒãƒ‰ãƒ™ãƒ¼ã‚¹ã§ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®ã™ã‚‹é–¢æ•°
  function randomizeCategories() {
    const container = document.getElementById('category-container');
    container.innerHTML = ''; // ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒªã‚¢
    
    // ã‚³ãƒ³ãƒ†ãƒŠã®ã‚µã‚¤ã‚ºã‚’å–å¾—
    const containerWidth = container.offsetWidth;
    const containerHeight = 150;
    container.style.minHeight = containerHeight + 'px';
    
    // ã‚°ãƒªãƒƒãƒ‰ã®è¨­å®š
    const columns = 4; // æ¨ªã®ã‚»ãƒ«æ•°
    const rows = 3;    // ç¸¦ã®ã‚»ãƒ«æ•°
    
    const cellWidth = containerWidth / columns;
    const cellHeight = containerHeight / rows;
    
    // ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«ã®çŠ¶æ…‹ã‚’ç®¡ç†ï¼ˆé…ç½®æ¸ˆã¿ã‹ã©ã†ã‹ï¼‰
    const gridCells = Array(rows).fill().map(() => Array(columns).fill(false));
    
    // ã€Œã™ã¹ã¦ã€ãƒœã‚¿ãƒ³ã¯å·¦ä¸Šã®ã‚»ãƒ«ã«å›ºå®š
    const allButton = document.createElement('button');
    allButton.className = `category-button absolute text-sm px-3 py-1 rounded-full bg-pink-400 text-white shadow-sm`;
    allButton.setAttribute('onclick', `filterCategory('all')`);
    allButton.setAttribute('data-category-btn', 'all');
    allButton.textContent = 'ã™ã¹ã¦';
    
    // ãƒœã‚¿ãƒ³ã®ã‚µã‚¤ã‚ºã‚’æ¨å®šï¼ˆãƒ†ã‚­ã‚¹ãƒˆé•·ã«åŸºã¥ãï¼‰
    const allButtonWidth = Math.max(allButton.textContent.length * 10 + 20, 60);
    const allButtonHeight = 30;
    
    // ã‚»ãƒ«å†…ã§ãƒœã‚¿ãƒ³ãŒåã¾ã‚‹ç¯„å›²ã§ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®
    const allButtonX = 10 + Math.random() * (cellWidth - allButtonWidth - 20);
    const allButtonY = 10 + Math.random() * (cellHeight - allButtonHeight - 20);
    
    allButton.style.left = `${allButtonX}px`;
    allButton.style.top = `${allButtonY}px`;
    allButton.style.animation = 'none'; // ã™ã¹ã¦ãƒœã‚¿ãƒ³ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—
    
    container.appendChild(allButton);
    gridCells[0][0] = true; // å·¦ä¸Šã®ã‚»ãƒ«ã‚’ä½¿ç”¨æ¸ˆã¿ã«ãƒãƒ¼ã‚¯
    
    // æ®‹ã‚Šã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒœã‚¿ãƒ³ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    const shuffledCategories = [...categories.slice(1)].sort(() => Math.random() - 0.5);
    
    // ãƒœã‚¿ãƒ³ã‚’é…ç½®
    shuffledCategories.forEach((category, index) => {
      // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«ã‚’é¸æŠï¼ˆã¾ã ä½¿ã‚ã‚Œã¦ã„ãªã„ã‚‚ã®ã‹ã‚‰ï¼‰
      let row, col;
      let found = false;
      let attempts = 0;
      
      // ç©ºã„ã¦ã„ã‚‹ã‚»ãƒ«ã‚’æ¢ã™
      while (!found && attempts < 50) {
        row = Math.floor(Math.random() * rows);
        col = Math.floor(Math.random() * columns);
        
        if (!gridCells[row][col]) {
          found = true;
          gridCells[row][col] = true; // ã‚»ãƒ«ã‚’ä½¿ç”¨æ¸ˆã¿ã«ãƒãƒ¼ã‚¯
        }
        attempts++;
      }
      
      // ç©ºã„ã¦ã„ã‚‹ã‚»ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€æ—¢ã«ä½¿ç”¨æ¸ˆã¿ã®ã‚»ãƒ«ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
      if (!found) {
        row = Math.floor(Math.random() * rows);
        col = Math.floor(Math.random() * columns);
      }
      
      const button = document.createElement('button');
      button.className = `category-button absolute text-sm px-3 py-1 rounded-full ${category.color} shadow-sm`;
      button.setAttribute('onclick', `filterCategory('${category.id}')`);
      button.setAttribute('data-category-btn', category.id);
      button.textContent = category.name;
      
      // ãƒœã‚¿ãƒ³ã®ã‚µã‚¤ã‚ºã‚’æ¨å®šï¼ˆãƒ†ã‚­ã‚¹ãƒˆé•·ã«åŸºã¥ãï¼‰
      const buttonWidth = Math.max(category.name.length * 10 + 20, 60);
      const buttonHeight = 30;
      
      // ã‚»ãƒ«å†…ã§ãƒœã‚¿ãƒ³ãŒç¢ºå®Ÿã«åã¾ã‚‹ç¯„å›²ã§ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®ã‚’è¨ˆç®—
      const xOffset = Math.random() * (cellWidth - buttonWidth - 20);
      const yOffset = Math.random() * (cellHeight - buttonHeight - 20);
      
      // æœ€çµ‚çš„ãªãƒœã‚¿ãƒ³ä½ç½®ï¼ˆæ å†…ã«åã¾ã‚‹ã“ã¨ã‚’ä¿è¨¼ï¼‰
      const buttonX = Math.max(10, Math.min(containerWidth - buttonWidth - 10, col * cellWidth + xOffset));
      const buttonY = Math.max(10, Math.min(containerHeight - buttonHeight - 10, row * cellHeight + yOffset));
      
      button.style.left = `${buttonX}px`;
      button.style.top = `${buttonY}px`;
      
      // ãµã‚ãµã‚ã¨æµ®ã„ã¦ã„ã‚‹ã‚ˆã†ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœã‚’è¿½åŠ 
      const animationDuration = 2 + Math.random() * 2; // 2ã€œ4ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ™‚é–“
      button.style.animation = `float ${animationDuration}s ease-in-out infinite`;
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹å§‹æ™‚é–“ã‚’ãšã‚‰ã™
      button.style.animationDelay = `${Math.random() * 2}s`;
      
      container.appendChild(button);
    });
  }
  
  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ãƒ©ãƒ³ãƒ€ãƒ é…ç½®
  document.addEventListener('DOMContentLoaded', randomizeCategories);
  
  // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é–¢æ•°
  function filterCategory(category) {
    // ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚³ãƒ¼ãƒ‰
    const items = document.querySelectorAll('.qa-item');
    items.forEach(item => {
      if (category === 'all' || item.dataset.category === category) {
        item.classList.remove('hidden');
      } else {
        item.classList.add('hidden');
      }
    });
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒœã‚¿ãƒ³ã®å¼·èª¿è¡¨ç¤º
    const buttons = document.querySelectorAll('[data-category-btn]');
    buttons.forEach(btn => {
      if (btn.getAttribute('data-category-btn') === category) {
        if (category !== 'all') {
          btn.classList.add('bg-pink-400', 'text-white');
          btn.classList.remove('bg-pink-200', 'hover:bg-pink-300');
        }
      } else if (btn.getAttribute('data-category-btn') === 'all') {
        // ã™ã¹ã¦ãƒœã‚¿ãƒ³ã¯å¸¸ã«ç‰¹åˆ¥ãªã‚¹ã‚¿ã‚¤ãƒ«
      } else {
        btn.classList.remove('bg-pink-400', 'text-white');
        btn.classList.add('bg-pink-200', 'hover:bg-pink-300');
      }
    });
    
    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¾Œã«ãƒœã‚¿ãƒ³ã‚’å†é…ç½®
    randomizeCategories();
  }
</script>




<!-- æœ€æ–°Q&Aãƒªã‚¹ãƒˆ -->
  <section class="p-3">
    <h2 class="text-lg font-bold mb-3">ğŸ“Œ æœ€æ–°ã®è³ªå•ï¼ˆ{{ questions|length }}ä»¶ï¼‰</h2>
    <div class="space-y-3">
      {% if questions %}
        {% for question in questions %}
          <div class="qa-item bg-white p-3 rounded-xl shadow" data-category="{{ question.category }}">
            <h3 class="font-semibold text-base">Q. {{ question.title }}</h3>
            <p class="text-xs text-gray-500 mb-1">ğŸ’¬ å›ç­”æ•°ï¼š{{ question.answer_count }}ä»¶</p>
            {% if question.answers %}
              <p class="mt-1 text-sm text-gray-800">A. {{ question.answers[0].content|truncate(50) }}</p>
            {% else %}
              <p class="mt-1 text-sm text-gray-500 italic">ã¾ã å›ç­”ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endif %}
          </div>
        {% endfor %}
      {% else %}
        <div class="text-center py-4 bg-white rounded-xl shadow">
          <p class="text-gray-500">ã¾ã è³ªå•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
          <button class="mt-2 bg-pink-400 hover:bg-pink-500 text-white text-sm px-6 py-2 rounded-full">æœ€åˆã®è³ªå•ã‚’æŠ•ç¨¿ã™ã‚‹</button>
        </div>
      {% endif %}
    </div>
  </section>
{% endblock %}
